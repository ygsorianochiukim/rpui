<div class="backgroundCover h-dvh">
  <div
    class="header p-2 pr-5 w-full flex flex-row gap-2 items-center justify-end rounded-br-2xl rounded-bl-2xl"
  >
    <header class="text-2xl mt-3 font-Playfair">Task Management</header>
  </div>
  <div class="flex flex-col items-center justify-start p-4 gap-4 overflow-auto h-[85%]">
    <div class="p-4 rounded-xl w-full bg-cards shadow-md border-l-4 border-primary">
      <header class="font-bold flex pb-1 font-Playfair text-2xl justify-between items-center">
        Task Information
        <lucide-icon [img]="Pencil"></lucide-icon>
      </header>
      <div>
        <div>
          <table>
            <tr>
              <td class="title font-Playfair">Task Name</td>
              <td class="!pl-3 font-Lora">: {{TaskInfo?.task_name}}</td>
            </tr>
            <tr>
              <td class="title font-Playfair">Description</td>
              <td class="!pl-3 text-justify font-Lora">
                : {{TaskInfo?.description}}
              </td>
            </tr>
            <tr>
              <td class="title font-Playfair">Assigned</td>
              <td class="!pl-3 font-Lora">
                : {{TaskInfo?.firstname | titlecase}} {{TaskInfo?.lastname |
                titlecase}}
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    <div
      class="p-4 rounded-xl w-full bg-cards shadow-md border-l-4 border-primary"
    >
      <header
        class="text-xl font-bold border-b-2 flex pb-2 justify-between items-center font-Playfair"
      >
        Task Steps @if (UserFunction != "Maker") {
        <button class="!px-3 !py-2 !rounded-md !border" (click)="stepVisible()">
          +
        </button>
        }
      </header>
      @for (step of TaskStepInfo; track $index) {
      <div class="mt-2">
        <div
          class="bg-navigation rounded-md overflow-hidden shadow-md font-Lora w-full flex gap-3 flex-row items-center"
        >
          <div
            class="p-3 text-center bg-secondary flex items-center justify-center"
          >
            {{$index + 1}}
          </div>
          {{step.task_steps_description}}
        </div>
      </div>
      }
    </div>
    <div
      class="p-4 rounded-xl w-full bg-cards shadow-md border-l-4 border-primary"
    >
      <header
        class="text-xl font-bold border-b-2 flex pb-2 justify-between items-center font-Playfair"
      >
        Task Files @if (UserFunction != "Maker") {
        <button class="!px-3 !py-2 !rounded-md !border" (click)="taskVisible()">
          +
        </button>
        }
      </header>
      @for (file of taskFile; track $index) {
      <div class="mt-3 flex justify-between items-center font-Lora">
        {{file.task_file_name}}
        <button (click)="downloadFile(file.task_file_id!)">
          <lucide-icon [img]="Download"></lucide-icon>
        </button>
      </div>
      }
    </div>
    <div
      class="p-4 rounded-xl w-full bg-cards shadow-md border-l-4 border-primary"
    >
      <header
        class="text-xl font-bold border-b-2 flex pb-2 justify-between items-center font-Playfair"
      >
        Task Notes @if (UserFunction != "Maker") {
        <button class="!px-3 !py-2 !rounded-md !border" (click)="noteVisible()">
          +
        </button>
        }
      </header>
      @for (note of TaskNoteInfo; track $index) {
      <div class="p-3 border mt-3 rounded-md font-Lora">{{note.task_note}}</div>
      }
    </div>
    <div
      class="p-4 rounded-xl w-full bg-cards shadow-md border-l-4 border-primary"
    >
      <header
        class="text-xl font-bold border-b-2 flex pb-2 justify-between items-center font-Playfair"
      >
        Due Date
        <button
          *ngIf="TaskDueDate.length <= 0"
          class="!px-3 !py-2 !rounded-md !border"
          (click)="dueDateVisible()"
        >
          +
        </button>
      </header>
      <div
        *ngFor="let deadline of TaskDueDate; let i = index"
        class="p-3 border mt-3 rounded-md font-Lora flex flex-row justify-between items-center"
      >
        {{ deadline.due_date }}
        <lucide-icon
          [img]="Pencil"
          [size]="20"
          (click)="editDueDate(deadline.task_due_date_id!)"
        >
        </lucide-icon>
      </div>
    </div>
    <div
      class="p-4 rounded-xl w-full bg-cards shadow-md border-l-4 border-primary"
    >
      <header
        class="text-xl font-bold border-b-2 flex pb-2 justify-between items-center font-Playfair"
      >
        Repeat
        <button
          *ngIf="TaskRepeat.length <= 0"
          class="!px-3 !py-2 !rounded-md !border"
          (click)="repeatVisible()"
        >
          +
        </button>
      </header>
      @for (repeat of TaskRepeat; track $index) {
      <div
        class="p-3 border mt-3 rounded-md font-Lora flex flex-row justify-between items-center"
      >
        {{repeat.repeat_frequency}}
        <lucide-icon
          [img]="Pencil"
          [size]="20"
          (click)="editRepeatDate(repeat.task_repeat_id!)"
        >
        </lucide-icon>
      </div>
      }
    </div>
    <!-- <div class="p-4 rounded-xl w-full bg-cards shadow-md border-l-4 border-primary">
      <header class="text-xl font-bold border-b-2 flex pb-2 justify-between items-center font-Playfair">
        Remind Me -->
    <!-- <button class="!px-3 !py-2 !rounded-md !border" (click)="noteVisible()">+</button> -->
    <!-- </header>
      @for (task of TaskRemind; track $index) {
        <div class="p-3 border mt-3 rounded-md font-Lora">
          {{task.remind_task}}
        </div>
      }
    </div>  -->
  </div>
  @if (CompleteButton) {
  <div class="w-full px-5 flex justify-end">
    <button
      (click)="markAsDone()"
      class="!p-4 !px-7 bg-cyan-400 !rounded-full text-xl w-full font-semibold"
    >
      Mark as Done
    </button>
  </div>
  }
</div>

<app-modal
  [isVisible]="stepisVisible"
  [titleHeader]="steptitleHeader"
  (closeModal)="closeStepModal()"
>
  <form (ngSubmit)="addNewStep()">
    <div class="mt-2">
      <label for="">Step Description</label>
      <input
        type="text"
        name="task_steps_description"
        [(ngModel)]="StepField.task_steps_description"
        class="w-full border-amber-950 border rounded-md p-2"
        id=""
      />
    </div>
    <button class="!p-3 mt-3 w-full bg-primary text-white !rounded-md">
      Save Changes
    </button>
  </form>
</app-modal>

<app-modal
  [isVisible]="noteisVisible"
  [titleHeader]="notetitleHeader"
  (closeModal)="closeNoteModal()"
>
  <form (ngSubmit)="addNewNote()">
    <div class="mt-2">
      <label for="">Notes</label>
      <input
        type="text"
        name="task_note"
        [(ngModel)]="NoteField.task_note"
        class="w-full border-amber-950 border rounded-md p-2"
        id=""
      />
    </div>
    <button class="!p-3 mt-3 w-full bg-primary text-white !rounded-md">
      Save Changes
    </button>
  </form>
</app-modal>

<app-modal
  [isVisible]="taskisVisible"
  [titleHeader]="tasktitleHeader"
  (closeModal)="closetaskModal()"
>
  <form (ngSubmit)="addNewFile()">
    <div class="mt-2">
      <label for="">Files</label>
      <div class="flex flex-row gap-2 items-center justify-between">
        <input
          type="file"
          name=""
          (change)="onFileSelected($event)"
          id=""
          class="w-full rounded-md border-amber-950 border p-3"
        />
      </div>
    </div>
    <button class="!p-3 mt-3 w-full bg-primary text-white !rounded-md">
      Save Changes
    </button>
  </form>
</app-modal>
<app-modal [isVisible]="repeatisVisible" [titleHeader]="repeattitleHeader" (closeModal)="closerepeatModal()">
  <form (ngSubmit)="addNewRepeat()">
    <div class="mt-2">
      <label for="">Repeat</label>
      <ion-list class="!p-0 bg-none">
        <ion-item class="w-full border pl-2 text-black rounded-md bg-none">
          <ion-select
            name="repeat_frequency"
            [(ngModel)]="DueRepeatField.repeat_frequency"
            placeholder="Repeat Freqency"
          >
            <ion-select-option value="Daily">Daily</ion-select-option>
            <ion-select-option value="Weekdays">Weekdays</ion-select-option>
            <ion-select-option value="Monthly">Monthly</ion-select-option>
            <ion-select-option value="Yearly">Yearly</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-list>
    </div>
    <button class="!p-3 mt-3 w-full bg-primary text-white !rounded-md">
      Save Changes
    </button>
  </form>
</app-modal>

<app-modal
  [isVisible]="dueisVisible"
  [titleHeader]="duetitleHeader"
  (closeModal)="closetaskdueModal()"
>
  <form (ngSubmit)="submitDueDate()">
    <button class="!p-3 mt-3 w-full bg-primary text-white !rounded-md">
      Save Changes
    </button>
  </form>
</app-modal>
<app-modal
  [isVisible]="dueisVisible"
  [titleHeader]="duetitleHeader"
  (closeModal)="closetaskdueModal()"
>
  <form (ngSubmit)="submitDueDate()">
    <div class="mt-2">
      <label for="">Due Date <span class="text-red-500">*</span></label>
      <ion-list *ngIf="!dueDateID" class="!p-0 bg-none">
        <ion-item class="w-full border pl-2 text-black rounded-md bg-none">
          <ion-select
            name="dueDateSelected"
            [(ngModel)]="dueDateSelected"
            placeholder="Due Date"
            (ngModelChange)="dateSelected()">
            <ion-select-option value="Today">Today</ion-select-option>
            <ion-select-option value="Tomorrow">Tomorrow</ion-select-option>
            <ion-select-option value="Next Week">Next Week</ion-select-option>
            <ion-select-option value="datePicker">Pick a Date</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-list>
      <div *ngIf="dueDateID != 0" class="p-4 bg-white rounded-md shadow-md z-50">
        <ion-datetime
          name="due_date"
          [(ngModel)]="DueDateField.due_date"
          class="w-full"
        ></ion-datetime>
      </div>
      <div *ngIf="showDateSelection == true" class="dateSelection p-4 bg-white rounded-md shadow-md z-50">
        <span (click)="close()">Close</span>
        <ion-datetime
          name="due_date"
          [(ngModel)]="DueDateField.due_date"
          class="w-full"
        ></ion-datetime>
      </div>
    </div>
    <button class="!p-3 mt-3 w-full bg-primary text-white !rounded-md">
      Save Changes
    </button>
  </form>
</app-modal>

